{% if citas_hoy_count > 0 %}
<!-- Badge flotante para mÃ³vil (arriba, lado izquierdo) -->
<div id="citasBadge" class="d-md-none position-fixed start-0" style="bottom: 120px; left: 5px; z-index: 1050;">
    <button class="btn btn-info rounded-circle shadow position-relative" onclick="document.getElementById('citasToastMobile').classList.toggle('d-none')" style="width: 42px; height: 42px; padding: 0;">
        <span style="font-size: 1.2rem;">ðŸ“…</span>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.65rem; padding: 0.2rem 0.35rem;">
            {{ citas_hoy_count }}
        </span>
        <button onclick="event.stopPropagation(); document.getElementById('citasBadge').style.display='none'; document.getElementById('citasToastMobile').classList.add('d-none');" class="position-absolute bottom-0 start-0 btn-close" style="font-size: 0.4rem; padding: 0.15rem; opacity: 1; margin: 2px; background-color: #dc3545; border-radius: 50%;"></button>
    </button>
</div>

<!-- Toast expandible mÃ³vil (oculto por defecto) -->
<div id="citasToastMobile" class="d-none d-md-none position-fixed start-0" style="bottom: 170px; left: 5px; max-width: 280px; z-index: 1049;">
    <div class="toast show align-items-center text-bg-info border-0" role="alert" style="font-size: 0.85rem;">
        <div class="d-flex">
            <div class="toast-body" style="padding: 0.6rem;">
                <strong style="font-size: 0.9em;">ðŸ“… Citas de Hoy</strong><br>
                Tienes {{ citas_hoy_count }} cita{{ citas_hoy_count|pluralize }} programada{{ citas_hoy_count|pluralize }}:
                <ul class="mb-0 mt-2" style="font-size: 0.75em; padding-left: 1rem; margin-bottom: 0.5rem;">
                    {% for cita in citas_hoy_sidebar %}
                    <li class="{% if cita.pasada %}text-decoration-line-through text-muted fst-italic{% endif %}">
                        <strong>{{ cita.inicio|date:"H:i" }}</strong> - {{ cita.titulo|truncatewords:5 }}
                    </li>
                    {% endfor %}
                </ul>
                <a href="{% url 'citas:eventos_ics' %}" class="btn btn-sm btn-light mt-2" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">Ver todas</a>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" onclick="document.getElementById('citasToastMobile').classList.add('d-none')" aria-label="Cerrar"></button>
        </div>
    </div>
</div>

<!-- Toast normal para desktop -->
<div class="d-none d-md-block toast-container position-fixed bottom-0 end-0 p-2" style="max-width: 90%; width: 280px;">
    <div id="citasToast" class="toast align-items-center text-bg-info border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="50000" style="font-size: 0.85rem;">
        <div class="d-flex">
            <div class="toast-body" style="padding: 0.6rem;">
                <strong style="font-size: 0.9em;">ðŸ“… Citas de Hoy</strong><br>
                Tienes {{ citas_hoy_count }} cita{{ citas_hoy_count|pluralize }} programada{{ citas_hoy_count|pluralize }}:
                <ul class="mb-0 mt-2" style="font-size: 0.75em; padding-left: 1rem; margin-bottom: 0.5rem;">
                    {% for cita in citas_hoy_sidebar %}
                    <li class="{% if cita.pasada %}text-decoration-line-through text-muted fst-italic{% endif %}">
                        <strong>{{ cita.inicio|date:"H:i" }}</strong> - {{ cita.titulo|truncatewords:5 }}
                    </li>
                    {% endfor %}
                </ul>
                <a href="{% url 'citas:eventos_ics' %}" class="btn btn-sm btn-light mt-2" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">Ver todas</a>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
        </div>
    </div>
</div>

<script>
    // Inicializar toast apenas se inyecta el HTML
    (function() {
        const toastEl = document.getElementById('citasToast');
        if (toastEl) {
             // Verificar si bootstrap estÃ¡ disponible globalmente
            if (typeof bootstrap !== 'undefined') {
                const toast = new bootstrap.Toast(toastEl);
                toast.show();
            }
        }
    })();
</script>
{% endif %}
