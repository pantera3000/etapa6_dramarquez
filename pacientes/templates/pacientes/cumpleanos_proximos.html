{% extends 'base.html' %}

{% block title %}ðŸŽ‚ CumpleaÃ±os PrÃ³ximos{% endblock %}

{% block content %}
{% load paciente_tags %}

<div class="d-flex justify-content-center">
    <div class="col-lg-11">
        <!-- Estilos Inline Festivos -->
        <style>
            .birthday-card {
                background: white; border: 1px solid #e2e8f0; border-radius: 1rem;
                overflow: hidden; transition: all 0.3s ease; position: relative;
            }
            .birthday-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: #cbd5e1; }
            
            .birthday-card.is-today { border: 2px solid #ec4899; background: linear-gradient(to bottom right, #fff1f2, #fff); }
            
            .confetti-bg {
                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                background-image: radial-gradient(#fb7185 1.5px, transparent 1.5px), radial-gradient(#f472b6 1.5px, transparent 1.5px);
                background-size: 20px 20px; background-position: 0 0, 10px 10px; opacity: 0.1; pointer-events: none;
            }
            
            .avatar-xl { width: 80px; height: 80px; font-size: 2rem; border: 4px solid white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
            
            .days-badge {
                position: absolute; top: 1rem; right: 1rem; padding: 0.5rem 1rem;
                border-radius: 2rem; font-weight: 700; font-size: 0.85rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
        </style>

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <a href="{% url 'pacientes:lista' %}" class="btn btn-outline-secondary btn-sm mb-2" 
                   onclick="if (document.referrer && document.referrer.includes(window.location.host)) { history.back(); return false; }">
                    <i class="bi bi-arrow-left"></i> AtrÃ¡s
                </a>
                <h2 class="mb-0 fw-bold text-dark">
                    ðŸŽ‚ PrÃ³ximos CumpleaÃ±os
                    <span class="fs-6 text-muted fw-normal ms-2">(PrÃ³ximos 6 meses)</span>
                </h2>
            </div>
            {% if pacientes %}
                <div class="badge bg-white text-dark border p-2 shadow-sm d-none d-md-block">
                    <i class="bi bi-gift text-danger"></i> {{ pacientes|length }} celebraciones
                </div>
            {% endif %}
        </div>

        {% if pacientes %}
            <div class="row g-4">
                {% for paciente in pacientes %}
                    <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                        <div class="birthday-card h-100 text-center p-4 {% if paciente.dias_hasta_cumple == 0 %}is-today{% endif %}">
                            {% if paciente.dias_hasta_cumple == 0 %}
                                <div class="confetti-bg"></div>
                                <div class="days-badge bg-danger text-white">
                                    Â¡HOY! ðŸŽ‰
                                </div>
                            {% else %}
                                <div class="days-badge bg-light text-muted border">
                                    Faltan {{ paciente.dias_hasta_cumple }} dÃ­as
                                </div>
                            {% endif %}

                            <div class="d-flex justify-content-center mb-3">
                                <div class="avatar-circle avatar-xl bg-primary text-white d-flex align-items-center justify-content-center rounded-circle" 
                                     style="background-color: {{ paciente.nombre_completo|avatar_color }} !important;">
                                    {{ paciente.nombre_completo|initials_avatar }}
                                </div>
                            </div>

                            <a href="{% url 'pacientes:detalle' paciente.pk %}" class="text-decoration-none text-dark stretched-link">
                                <h5 class="fw-bold mb-1">{{ paciente.nombre_completo }}</h5>
                            </a>
                            
                            <p class="text-muted small mb-3">DNI: {{ paciente.dni }}</p>

                            <div class="d-inline-block bg-white border rounded-pill px-3 py-1 text-muted small mb-3 shadow-sm">
                                ðŸŽ‚ CumplirÃ¡ <strong>{{ paciente.edad|add:"1" }}</strong> aÃ±os
                            </div>
                            
                            <div class="border-top pt-3 mt-2">
                                <div class="d-flex justify-content-center gap-2 align-items-center text-secondary">
                                    <i class="bi bi-calendar-event"></i>
                                    <span class="fw-medium">{{ paciente.fecha_nacimiento|date:"d \d\e F" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- EMPTY STATE -->
            <div class="text-center py-5 bg-white rounded shadow-sm border">
                <div class="mb-3">
                    <i class="bi bi-calendar-x display-1 text-muted opacity-25"></i>
                </div>
                <h4 class="text-muted fw-normal">No hay cumpleaÃ±os cercanos</h4>
                <p class="text-muted small mb-4">No se encontraron pacientes que cumplan aÃ±os en los prÃ³ximos 180 dÃ­as.</p>
                <a href="{% url 'pacientes:lista' %}" class="btn btn-primary">Volver a la lista</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}