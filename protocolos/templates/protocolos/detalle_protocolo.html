{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle Protocolo Ni√±o{% endblock %}

{% block extra_css %}
<style>
    .opcion-row {
        display: flex;
        align-items: center;
        margin-bottom: 4px;
        color: #666;
    }
    .opcion-row.seleccionada {
        color: #0d6efd;
        font-weight: bold;
    }
    .check-icon {
        width: 20px;
        display: inline-block;
        font-size: 1.2em;
    }
    .seccion-titulo {
        background-color: #f0f2f5;
        padding: 10px 15px;
        border-left: 4px solid #0d6efd;
        margin-top: 20px;
        margin-bottom: 15px;
        font-weight: bold;
        color: #2c3e50;
    }
    .subtitulo {
        font-size: 0.95rem;
        font-weight: bold;
        color: #555;
        margin-bottom: 8px;
        margin-top: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 4px;
    }
    .info-header {
        background-color: #e3f2fd;
        border-radius: 8px;
        padding: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Encabezado -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-0">üìã Protocolo Ni√±o</h2>
                <div class="text-muted small">Cuestionario completo y respuestas</div>
            </div>
            <div class="btn-group">
                <a href="{% url 'pacientes:detalle' paciente.id %}" class="btn btn-outline-secondary">‚Üê Volver</a>
                <a href="{% url 'protocolos:editar' protocolo.id %}" class="btn btn-warning">‚úèÔ∏è Editar</a>
                <a href="{% url 'protocolos:pdf' protocolo.id %}" target="_blank" class="btn btn-danger">üìÑ Exportar PDF</a>
            </div>
        </div>

        <div class="card shadow-sm mb-5">
            <div class="card-body p-4">
                
                <!-- Datos B√°sicos -->
                <div class="info-header mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h4 class="mb-1 text-primary">{{ paciente.nombre_completo }}</h4>
                            <p class="mb-0">
                                <strong>Fecha:</strong> {{ protocolo.fecha|date:"d/m/Y" }} | 
                                <strong>Edad:</strong> {{ protocolo.edad_protocolo }} a√±os
                            </p>
                        </div>
                        <div class="col-md-6 text-md-end mt-2 mt-md-0">
                            <strong>Estado General:</strong>
                            {% if protocolo.estado_satisfactorio %}<span class="badge bg-success">Satisfactorio</span>{% endif %}
                            {% if protocolo.estado_mejorable %}<span class="badge bg-warning text-dark">Mejorable</span>{% endif %}
                            {% if protocolo.estado_muy_mejorable %}<span class="badge bg-danger">Muy Mejorable</span>{% endif %}
                            {% if not protocolo.estado_satisfactorio and not protocolo.estado_mejorable and not protocolo.estado_muy_mejorable %}
                                <span class="badge bg-secondary">Sin especificar</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- COLUMNA IZQUIERDA -->
                    <div class="col-md-6 pe-md-4">
                        
                        <!-- 1. EVALUACI√ìN F√çSICA -->
                        <div class="seccion-titulo">1. EVALUACI√ìN F√çSICA A RESPIRATORIA</div>
                        
                        <div class="row">
                            <div class="col-6">
                                <div class="subtitulo">Ventana nasal m√°s cerrada</div>
                                <div class="opcion-row {% if protocolo.ventana_mas_cerrada == 'D' %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.ventana_mas_cerrada == 'D' %}‚úÖ{% else %}‚ö™{% endif %}</span> Derecha
                                </div>
                                <div class="opcion-row {% if protocolo.ventana_mas_cerrada == 'I' %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.ventana_mas_cerrada == 'I' %}‚úÖ{% else %}‚ö™{% endif %}</span> Izquierda
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="subtitulo">Respira mejor</div>
                                <div class="opcion-row {% if protocolo.respira_mejor == 'D' %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.respira_mejor == 'D' %}‚úÖ{% else %}‚ö™{% endif %}</span> Derecha
                                </div>
                                <div class="opcion-row {% if protocolo.respira_mejor == 'I' %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.respira_mejor == 'I' %}‚úÖ{% else %}‚ö™{% endif %}</span> Izquierda
                                </div>
                            </div>
                        </div>

                        <div class="subtitulo mt-3">Sellado labial y cara</div>
                        <div class="opcion-row {% if protocolo.sellado_labial_reposo %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.sellado_labial_reposo %}‚úÖ{% else %}‚ö™{% endif %}</span> Sellado labial en reposo
                        </div>
                        <div class="opcion-row {% if protocolo.fascies_adenoidea %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.fascies_adenoidea %}‚úÖ{% else %}‚ö™{% endif %}</span> Fascies adenoidea (ojeras)
                        </div>
                        <div class="opcion-row {% if protocolo.labios_cortados %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.labios_cortados %}‚úÖ{% else %}‚ö™{% endif %}</span> Labios cortados
                        </div>

                        <div class="subtitulo mt-3">Patr√≥n de crecimiento</div>
                        {% for val, label in form.patron_crecimiento.field.choices %}
                            <div class="opcion-row {% if protocolo.patron_crecimiento == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.patron_crecimiento == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <div class="subtitulo mt-3">Maloclusi√≥n</div>
                        {% for val, label in form.maloclusion.field.choices %}
                            <div class="opcion-row {% if protocolo.maloclusion == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.maloclusion == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <div class="subtitulo mt-3">Mordida cruzada / abierta</div>
                        {% for val, label in form.mordida_cruzada.field.choices %}
                            <div class="opcion-row {% if protocolo.mordida_cruzada == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.mordida_cruzada == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}
                        <div class="opcion-row {% if protocolo.mordida_abierta %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.mordida_abierta %}‚úÖ{% else %}‚ö™{% endif %}</span> Mordida abierta
                        </div>
                        
                        <div class="subtitulo mt-3">Sobremordida</div>
                        {% for val, label in form.sobremordida.field.choices %}
                            <div class="opcion-row {% if protocolo.sobremordida == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.sobremordida == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <div class="subtitulo mt-3">Am√≠gdalas</div>
                        <div class="row">
                            <div class="col-6">
                                <small class="text-muted d-block mb-1">Grado:</small>
                                {% for val, label in form.amigdalas_grado.field.choices %}
                                    <div class="opcion-row {% if protocolo.amigdalas_grado == val %}seleccionada{% endif %}">
                                        <span class="check-icon">{% if protocolo.amigdalas_grado == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block mb-1">Inflamada:</small>
                                {% for val, label in form.amigdalas_inflamada.field.choices %}
                                    <div class="opcion-row {% if protocolo.amigdalas_inflamada == val %}seleccionada{% endif %}">
                                        <span class="check-icon">{% if protocolo.amigdalas_inflamada == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- 3. CAPACIDAD RESPIRATORIA -->
                        <div class="seccion-titulo">3. CAPACIDAD RESPIRATORIA</div>
                        
                        <div class="subtitulo">Degluci√≥n</div>
                        <div class="opcion-row {% if protocolo.deglucion_normal %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.deglucion_normal %}‚úÖ{% else %}‚ö™{% endif %}</span> Traga con normalidad
                        </div>
                        <div class="opcion-row {% if protocolo.deglucion_dificultad %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.deglucion_dificultad %}‚úÖ{% else %}‚ö™{% endif %}</span> Traga con dificultad
                        </div>
                        <div class="opcion-row {% if protocolo.mete_lengua_dientes %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.mete_lengua_dientes %}‚úÖ{% else %}‚ö™{% endif %}</span> Mete lengua entre dientes
                        </div>
                        <div class="opcion-row {% if protocolo.lengua_marcas_bordes %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.lengua_marcas_bordes %}‚úÖ{% else %}‚ö™{% endif %}</span> Lengua marcas en bordes
                        </div>

                        <div class="subtitulo mt-3">Lengua con boca abierta</div>
                        <div class="opcion-row {% if protocolo.lengua_alcanza_nariz %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.lengua_alcanza_nariz %}‚úÖ{% else %}‚ö™{% endif %}</span> Alcanza la nariz
                        </div>
                        <div class="opcion-row {% if protocolo.lengua_llega_paladar %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.lengua_llega_paladar %}‚úÖ{% else %}‚ö™{% endif %}</span> Llega al paladar
                        </div>
                        <div class="opcion-row {% if protocolo.lengua_mitad_camino %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.lengua_mitad_camino %}‚úÖ{% else %}‚ö™{% endif %}</span> Mitad de camino
                        </div>
                        <div class="opcion-row {% if protocolo.lengua_apenas_incisivos %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.lengua_apenas_incisivos %}‚úÖ{% else %}‚ö™{% endif %}</span> Apenas incisivos
                        </div>

                    </div>

                    <!-- COLUMNA DERECHA -->
                    <div class="col-md-6 ps-md-4 border-start-md">
                        
                        <!-- 2. CAPACIDAD MASTICATORIA -->
                        <div class="seccion-titulo" style="margin-top: 20px;">2. CAPACIDAD MASTICATORIA</div>
                        
                        <div class="row">
                            <div class="col-6">
                                <div class="subtitulo">Masticador</div>
                                <div class="opcion-row {% if protocolo.masticador_derecho %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.masticador_derecho %}‚úÖ{% else %}‚ö™{% endif %}</span> Derecho
                                </div>
                                <div class="opcion-row {% if protocolo.masticador_izquierdo %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.masticador_izquierdo %}‚úÖ{% else %}‚ö™{% endif %}</span> Izquierdo
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="subtitulo">Prefiere</div>
                                <div class="opcion-row {% if protocolo.prefiere_yogurt %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.prefiere_yogurt %}‚úÖ{% else %}‚ö™{% endif %}</span> Yogurt
                                </div>
                                <div class="opcion-row {% if protocolo.prefiere_manzana %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.prefiere_manzana %}‚úÖ{% else %}‚ö™{% endif %}</span> Manzana
                                </div>
                                <div class="opcion-row {% if protocolo.prefiere_naranja %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.prefiere_naranja %}‚úÖ{% else %}‚ö™{% endif %}</span> Naranja
                                </div>
                                <div class="opcion-row {% if protocolo.prefiere_zumo %}seleccionada{% endif %}">
                                    <span class="check-icon">{% if protocolo.prefiere_zumo %}‚úÖ{% else %}‚ö™{% endif %}</span> Zumo
                                </div>
                            </div>
                        </div>

                        <div class="subtitulo mt-3">H√°bitos alimenticios</div>
                        <div class="opcion-row {% if protocolo.corta_bocados == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.corta_bocados == True %}‚úÖ{% else %}‚ö™{% endif %}</span> ¬øCorta a bocados?
                        </div>
                        <div class="opcion-row {% if protocolo.aguanta_5min_sellado == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.aguanta_5min_sellado == True %}‚úÖ{% else %}‚ö™{% endif %}</span> ¬øAguanta 5 min sellado?
                        </div>
                        <div class="opcion-row {% if protocolo.sellado_labial_dia == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.sellado_labial_dia == True %}‚úÖ{% else %}‚ö™{% endif %}</span> ¬øMantiene sellado el d√≠a?
                        </div>
                        <div class="opcion-row {% if protocolo.sellado_labial_durmiendo == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.sellado_labial_durmiendo == True %}‚úÖ{% else %}‚ö™{% endif %}</span> ¬øMantiene sellado durmiendo?
                        </div>
                        <div class="opcion-row {% if protocolo.es_respirador_oral == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.es_respirador_oral == True %}‚úÖ{% else %}‚ö™{% endif %}</span> ¬øEs respirador oral?
                        </div>
                        
                        <div class="subtitulo mt-3">Tiempo tarda en comer</div>
                        {% for val, label in form.tiempo_comer.field.choices %}
                            <div class="opcion-row {% if protocolo.tiempo_comer == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.tiempo_comer == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <!-- 4. ALERGIAS -->
                        <div class="seccion-titulo">4. HISTORIAL Y ALERGIAS</div>
                        
                        <div class="opcion-row {% if protocolo.es_alergico == True %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.es_alergico == True %}‚úÖ{% else %}‚ö™{% endif %}</span> Es al√©rgico / Intolerante
                        </div>
                        {% if protocolo.alergico_a %}
                        <div class="ms-4 text-muted small fst-italic">"{{ protocolo.alergico_a }}"</div>
                        {% endif %}

                        <div class="row mt-2">
                            <div class="col-4">
                                <div class="subtitulo">Resfr√≠os</div>
                                <div class="fw-bold text-primary">{{ protocolo.get_veces_resfrio_display|default:"-" }}</div>
                            </div>
                            <div class="col-4">
                                <div class="subtitulo">Amigd/Rin</div>
                                <div class="fw-bold text-primary">{{ protocolo.get_veces_amigdalitis_display|default:"-" }}</div>
                            </div>
                            <div class="col-4">
                                <div class="subtitulo">Antibi√≥t.</div>
                                <div class="fw-bold text-primary">{{ protocolo.get_veces_antibioticos_display|default:"-" }}</div>
                            </div>
                        </div>

                        <!-- 5. SUE√ëO Y RESPIRACI√ìN -->
                        <div class="seccion-titulo">5. SUE√ëO Y RESPIRACI√ìN</div>
                        
                        <div class="subtitulo">Respiraci√≥n nocturna</div>
                        {% for val, label in form.respiracion_nocturna.field.choices %}
                            <div class="opcion-row {% if protocolo.respiracion_nocturna == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.respiracion_nocturna == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <div class="subtitulo mt-2">Movilidad al dormir</div>
                        {% for val, label in form.movilidad_dormir.field.choices %}
                            <div class="opcion-row {% if protocolo.movilidad_dormir == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.movilidad_dormir == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}

                        <div class="subtitulo mt-2">Bruxismo</div>
                        {% for val, label in form.bruxismo.field.choices %}
                            <div class="opcion-row {% if protocolo.bruxismo == val %}seleccionada{% endif %}">
                                <span class="check-icon">{% if protocolo.bruxismo == val %}‚úÖ{% else %}‚ö™{% endif %}</span> {{ label }}
                            </div>
                        {% endfor %}
                    </div>
                </div> <!-- End Row -->

                <hr class="my-4">

                <div class="row">
                    <!-- 6. EVALUACI√ìN GENERAL -->
                    <div class="col-md-6 pe-md-4">
                         <div class="seccion-titulo mt-0">6. EVALUACI√ìN DE FUNCIONES</div>
                         
                         <div class="subtitulo">Masticaci√≥n / Respiraci√≥n / Degluci√≥n</div>
                         <table class="table table-sm table-borderless">
                             <tr>
                                 <td>Masticaci√≥n:</td>
                                 <td class="fw-bold text-primary">{{ protocolo.get_masticacion_eval_display|default:"-" }}</td>
                             </tr>
                             <tr>
                                 <td>Respiraci√≥n:</td>
                                 <td class="fw-bold text-primary">{{ protocolo.get_respiracion_eval_display|default:"-" }}</td>
                             </tr>
                             <tr>
                                 <td>Degluci√≥n:</td>
                                 <td class="fw-bold text-primary">{{ protocolo.get_deglucion_eval_display|default:"-" }}</td>
                             </tr>
                         </table>

                         <div class="subtitulo mt-3">Evaluaci√≥n Neurovegetativa</div>
                         <table class="table table-sm table-borderless">
                            <tr>
                                <td>Fonaci√≥n:</td>
                                <td class="fw-bold">{{ protocolo.get_fonacion_display|default:"-" }}</td>
                            </tr>
                            <tr>
                                <td>Actif. F√≠sica:</td>
                                <td class="fw-bold">{{ protocolo.get_actividad_fisica_display|default:"-" }}</td>
                            </tr>
                            <tr>
                                <td>H√°bitos:</td>
                                <td class="fw-bold">{{ protocolo.get_habitos_alimentarios_display|default:"-" }}</td>
                            </tr>
                            <tr>
                                <td>Pantallas:</td>
                                <td class="fw-bold">{{ protocolo.get_horas_pantallas_display|default:"-" }}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- 7. TRATAMIENTO -->
                    <div class="col-md-6 ps-md-4 border-start-md">
                        <div class="seccion-titulo mt-0">7. PLAN DE TRATAMIENTO</div>
                        
                        <div class="opcion-row {% if protocolo.plan_refuerzo_habitos %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_refuerzo_habitos %}‚úÖ{% else %}‚ö™{% endif %}</span> Refuerzo h√°bitos saludables
                        </div>
                        <div class="opcion-row {% if protocolo.plan_placa_confort %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_placa_confort %}‚úÖ{% else %}‚ö™{% endif %}</span> PlacaConfort
                        </div>
                        <div class="opcion-row {% if protocolo.plan_deglu_confort %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_deglu_confort %}‚úÖ{% else %}‚ö™{% endif %}</span> DegluConfort
                        </div>
                        <div class="opcion-row {% if protocolo.plan_nariz_confort %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_nariz_confort %}‚úÖ{% else %}‚ö™{% endif %}</span> NarizConfort
                        </div>
                        <div class="opcion-row {% if protocolo.plan_mascalin %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_mascalin %}‚úÖ{% else %}‚ö™{% endif %}</span> Mascal√≠n
                        </div>
                        
                        <div class="subtitulo mt-3">Alimentaci√≥n</div>
                        <div class="opcion-row {% if protocolo.plan_retirada_lacteos %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_retirada_lacteos %}‚úÖ{% else %}‚ö™{% endif %}</span> Retirada l√°cteos
                        </div>
                        <div class="opcion-row {% if protocolo.plan_evitar_azucar %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_evitar_azucar %}‚úÖ{% else %}‚ö™{% endif %}</span> Evitar az√∫car
                        </div>
                        <div class="opcion-row {% if protocolo.plan_alimentos_duros %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_alimentos_duros %}‚úÖ{% else %}‚ö™{% endif %}</span> Alimentos duros
                        </div>
                        <div class="opcion-row {% if protocolo.plan_comer_sin_cubiertos %}seleccionada{% endif %}">
                            <span class="check-icon">{% if protocolo.plan_comer_sin_cubiertos %}‚úÖ{% else %}‚ö™{% endif %}</span> Comer sin cubiertos
                        </div>
                        
                        {% if protocolo.plan_comer_lado %}
                        <div class="opcion-row seleccionada mt-2">
                            <span class="check-icon">‚úÖ</span> Comer por lado: {{ protocolo.get_plan_comer_lado_display }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Textos -->
                {% if protocolo.antecedentes_interes or protocolo.enfermedad_actual or protocolo.medicacion_actual %}
                <div class="seccion-titulo">INFORMACI√ìN ADICIONAL</div>
                <div class="row">
                    {% if protocolo.antecedentes_interes %}
                    <div class="col-md-4">
                        <div class="subtitulo">Antecedentes</div>
                        <p class="small text-muted">{{ protocolo.antecedentes_interes }}</p>
                    </div>
                    {% endif %}
                    {% if protocolo.enfermedad_actual %}
                    <div class="col-md-4">
                        <div class="subtitulo">Enfermedad Actual</div>
                        <p class="small text-muted">{{ protocolo.enfermedad_actual }}</p>
                    </div>
                    {% endif %}
                    {% if protocolo.medicacion_actual %}
                    <div class="col-md-4">
                        <div class="subtitulo">Medicaci√≥n</div>
                        <p class="small text-muted">{{ protocolo.medicacion_actual }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endblock %}
