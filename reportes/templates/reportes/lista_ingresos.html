{% extends 'base.html' %}
{% load static %}
{% load l10n %}

{% block title %}Reporte - Ingresos{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 animate-fade-in-up">
    <div>
        <h1 class="h3 fw-bold text-gray-800">
            <i class="bi bi-graph-up me-2 text-success"></i>Reporte de Ingresos
        </h1>
        <p class="text-muted mb-0">Historial de pagos recibidos recientemente.</p>
    </div>
    <a href="{% url 'reportes:dashboard' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Volver
    </a>
</div>

<!-- Filtros de Tiempo -->
<div class="card shadow-sm border-0 mb-4 animate-fade-in-up">
    <div class="card-body p-2">
        <nav class="nav nav-pills nav-fill">
            <a class="nav-link {% if rango_actual == 'hoy' %}active bg-success{% endif %}" href="?rango=hoy">Hoy</a>
            <a class="nav-link {% if rango_actual == 'semana' %}active bg-success{% endif %}" href="?rango=semana">Esta Semana</a>
            <a class="nav-link {% if rango_actual == 'mes' %}active bg-success{% endif %}" href="?rango=mes">Este Mes</a>
            <a class="nav-link {% if rango_actual == 'mes_anterior' %}active bg-success{% endif %}" href="?rango=mes_anterior">Mes Anterior</a>
            <a class="nav-link {% if rango_actual == 'anio' %}active bg-success{% endif %}" href="?rango=anio">Este Año</a>
            <a class="nav-link {% if rango_actual == 'todos' %}active bg-success{% endif %}" href="?rango=todos">Histórico</a>
        </nav>
    </div>
</div>

<div class="card shadow-sm border-0 animate-fade-in-up" style="animation-delay: 0.1s;">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold text-success">{{ titulo_filtro }}</h5>
        <span class="badge bg-success fs-6">Total: S/ {{ total_periodo|floatformat:2 }}</span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Fecha</th>
                        <th>Paciente</th>
                        <th>Tratamiento</th>
                        <th>Método</th>
                        <th>Monto</th>
                        <th class="text-end pe-4">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pago in pagos %}
                    <tr>
                        <td class="ps-4">{{ pago.fecha_pago|date:"d/m/Y H:i" }}</td>
                        <td class="fw-medium">
                            <a href="{% url 'pacientes:detalle' pago.tratamiento.paciente.pk %}" class="text-decoration-none text-dark">
                                {{ pago.tratamiento.paciente.nombre_completo }}
                            </a>
                        </td>
                        <td>{{ pago.tratamiento.nombre }}</td>
                        <td>
                            {% if pago.metodo_pago == 'efectivo' %}
                                <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-pill px-3">
                                    <i class="bi bi-cash me-1"></i> Efectivo
                                </span>
                            {% elif pago.metodo_pago == 'yape' or pago.metodo_pago == 'plin' %}
                                <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill px-3">
                                    <i class="bi bi-phone me-1"></i> Digital
                                </span>
                            {% else %}
                                <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 rounded-pill px-3">
                                    <i class="bi bi-bank me-1"></i> {{ pago.get_metodo_pago_display }}
                                </span>
                            {% endif %}
                        </td>
                        <td class="fw-bold text-success">S/ {{ pago.monto|floatformat:2 }}</td>
                        <td class="text-end pe-4">
                            <a href="{% url 'tratamientos:detalle' pago.tratamiento.pk %}" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <h5 class="text-muted">No hay registros de pagos recientes.</h5>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
